import{r as n,u as D,b as F,R as e,c as L,l as P,i as x}from"./index-DWn6bmYd.js";const q="/assets/upload-CeSlhBx2.png",A=()=>{const[t,d]=n.useState({title:"",description:"",category:"",course:"",lecturer:"",semester:"",attachment:null}),S=D(),C=F()||{},{onRefresh:b}=C,[h,I]=n.useState([]),[f,R]=n.useState([]),[u,N]=n.useState(!1),[l,v]=n.useState(!1),[c,m]=n.useState({courses:null,lecturers:null,submit:null}),y=n.useRef(null);n.useEffect(()=>{(async()=>{N(!0),m({courses:null,lecturers:null,submit:null});try{const a=await L.getCourses();I(a)}catch(a){console.error("Error fetching courses:",a),m(r=>({...r,courses:"Failed to load courses. Please try again."}))}try{const a=await P.getLecturers();R(a)}catch(a){console.error("Error fetching lecturers:",a),m(r=>({...r,lecturers:"Failed to load lecturers. Please try again."}))}N(!1)})()},[]);const o=s=>{const{name:a,value:r,files:i}=s.target;d({...t,[a]:i?i[0]:r})},k=s=>{s.preventDefault(),y.current.click()},p=()=>t.title&&t.description&&t.category&&t.course&&t.semester,w=async s=>{if(s.preventDefault(),!p())return;v(!0),m({...c,submit:null});const a=new FormData;a.append("title",t.title),a.append("description",t.description),a.append("issue_type",t.category),a.append("course",t.course),a.append("semester",t.semester),t.lecturer&&a.append("assigned_to",t.lecturer),t.attachment&&a.append("image",t.attachment),t.lecturer&&a.append("lecturer",t.lecturer),t.attachment&&a.append("image",t.attachment);try{await x.createIssue(a),d({title:"",description:"",category:"",course:"",lecturer:"",semester:"",attachment:null}),b&&await b();const r=localStorage.getItem("userRole")||"student";S(`/${r}/dashboard`)}catch(r){console.error("Error submitting issue:",r),m(i=>({...i,submit:"Failed to submit issue. Please try again."}))}finally{v(!1)}},g=h.find(s=>{var a;return s.id.toString()===((a=t.course)==null?void 0:a.toString())}),E=f.find(s=>{var a;return s.id.toString()===((a=t.lecturer)==null?void 0:a.toString())});return e.createElement("div",{className:"issue-form-container"},e.createElement("div",{className:"issue-form-header"},e.createElement("h1",null,"Create a New Issue")),e.createElement("div",{className:"issue-form-content"},e.createElement("label",{className:"course-label"},"Course ",e.createElement("span",{className:"required"},"*"),e.createElement("select",{name:"course",value:t.course,onChange:o,className:"course-select",disabled:u||l},e.createElement("option",{value:""},"Select Course"),h.map(s=>e.createElement("option",{key:s.id,value:s.id},s.code," - ",s.name))),c.courses&&e.createElement("div",{className:"error-message"},c.courses),u&&e.createElement("div",{className:"loading-message"},"Loading courses...")),e.createElement("label",{className:"semester-label"},"Semester ",e.createElement("span",{className:"required"},"*"),e.createElement("select",{name:"semester",value:t.semester,onChange:o,className:"semester-select",disabled:l},e.createElement("option",{value:""},"Select Semester"),e.createElement("option",{value:"semester 1"},"Semester 1"),e.createElement("option",{value:"semester 2"},"Semester 2"))),e.createElement("label",{className:"lecturer-label"},"Lecturer (Optional)",e.createElement("select",{name:"lecturer",value:t.lecturer,onChange:o,className:"lecturer-select",disabled:u||l},e.createElement("option",{value:""},"Select Lecturer"),f.map(s=>e.createElement("option",{key:s.id,value:s.id},s.fullname))),c.lecturers&&e.createElement("div",{className:"error-message"},c.lecturers),u&&e.createElement("div",{className:"loading-message"},"Loading lecturers...")),e.createElement("label",{className:"upload-label"},"Upload Photo (Optional)",e.createElement("div",{className:"upload-section"},t.attachment?e.createElement("div",{className:"attachment-preview"},e.createElement("img",{src:URL.createObjectURL(t.attachment),alt:"Selected attachment",className:"selected-image"}),e.createElement("button",{className:"remove-attachment",onClick:()=>d({...t,attachment:null}),disabled:l},"Remove")):e.createElement(e.Fragment,null,e.createElement("img",{src:q,alt:"upload",className:"upload-icon"}),e.createElement("button",{onClick:k,className:"upload-link",disabled:l},"Upload a file")," ","or drag and drop PNG, JPG"),e.createElement("input",{type:"file",ref:y,style:{display:"none"},accept:"image/png, image/jpeg",name:"attachment",onChange:o,disabled:l}))),e.createElement("label",{className:"issue-label"},"Issue Title ",e.createElement("span",{className:"required"},"*"),e.createElement("input",{className:"issue-title-input",type:"text",name:"title",placeholder:"Enter Issue Title",value:t.title,onChange:o,disabled:l})),e.createElement("label",{className:"issue-label"},"Issue Category ",e.createElement("span",{className:"required"},"*"),e.createElement("select",{className:"issue-select",name:"category",value:t.category,onChange:o,disabled:l},e.createElement("option",{value:""},"Select Category"),e.createElement("option",{value:"missing_marks"},"Missing Marks"),e.createElement("option",{value:"appeal"},"Appeal"),e.createElement("option",{value:"correction"},"Correction"))),e.createElement("label",{className:"issue-label"},"Issue Description ",e.createElement("span",{className:"required"},"*"),e.createElement("textarea",{name:"description",placeholder:"Enter the issue description",className:"issue-description-input",value:t.description,onChange:o,rows:4,disabled:l})),p()&&e.createElement("div",{className:"issue-summary"},e.createElement("h3",null,"Issue Summary"),e.createElement("p",null,e.createElement("strong",null,"Course:")," ",g?`${g.code} - ${g.name}`:""),e.createElement("p",null,e.createElement("strong",null,"Semester:")," ",t.semester),t.lecturer&&e.createElement("p",null,e.createElement("strong",null,"Lecturer:")," ",(E==null?void 0:E.fullname)||""),e.createElement("p",null,e.createElement("strong",null,"Issue Type:")," ",t.category.replace("_"," ").replace(/\b\w/g,s=>s.toUpperCase()))),c.submit&&e.createElement("div",{className:"error-submit"},c.submit),e.createElement("button",{className:"issue-submit-button",onClick:w,disabled:!p()||l},l?"Submitting...":"Submit Issue")))};export{A as default};
